Puppet WebHooks
====

[![Build Status](https://travis-ci.org/puppetlabs/puppet-webhooks.png?branch=master)](https://travis-ci.org/puppetlabs/puppet-webhooks)

puppet-webhooks acts as a relay from Github and other services to Jira and
Trello, so that events on a Github project automatically create and update Jira
issues or Trello cards.

Event sources
-------------

Right now the current source of events is Github. The following events can be
generated by Github:

  * Pull request opened/closed/reopened
  * Issue opened/closed/reopened
  * Comment added on a pull request/issue

For more information, see README_GITHUB.md.

There is preliminary support for events generated by Travis-ci, but it is not
yet fully functional.

Event destinations
------------------

Jira and Trello can be used as destinations for events. Both can be used
concurrently.

Trello supports the following events:

  * new Github pull requests create a card
  * new Github issues create a card
  * Closing/reopening a pull request/issue adds a comment on the related card
  * Commenting on a pull request/issue adds a comment to the related card

Jira supports the following events:

  * new Github pull requests link to referenced Jira issues
  * new Github pull requests without a referenced Jira card are added as issues
  * Closing/reopening a pull request adds a comment on the Jira issue
  * Commenting on a pull request adds a comment to the related issue

Importing
---------

Existing PRs can be imported to Trello/Jira by exporting the necessary
environment variables and then issuing:

    $ rake import:prs REPO=puppetlabs/puppet
    $ rake jobs:worksilent

This will queue jobs for each PR currently open, then run a worker to process
the queue.  This can be done on a standalone system, with a sqlite database
configured in `config/database.yml`, after running `rake db:migrate`.

Individual PRs can be imported by also specifying "PR=123".

Running tests
-------------

The spec tests are configured to use an in-memory sqlite3 database with
ActiveRecord and DelayedJob.  The rake tasks, spec helper, and application
itself should use the `PuppetLabs::Webhook.setup_environment` method to setup
the database connection. The RACK_ENV is forced to 'test' when running the
specs to ensure that test runs are consistent.

To run the specs:

    $ bundle exec rake spec
Or
    $ bundle exec rspec

License
-------

Apache 2.0.  Please see the LICENSE file for more information.
